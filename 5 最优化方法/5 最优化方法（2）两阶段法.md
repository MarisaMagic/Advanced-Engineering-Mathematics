<h1>
    <div align='center'>
        第五章 最优化方法（2）
        二阶段法
    </div>
</h1>

## 二阶段法

### 为什么需要二阶段法

标准单纯形法通常要求一开始就有一个“**基本可行解**”（基变量刚好构成单位阵、右端常数 ≥ 0）。
但遇到：

* 有“≥”约束（要减去剩余变量）；
* 有“=”约束；
* 或者加完松弛/剩余变量后仍然凑不出单位阵，

就 **凑不出初始基变量**，必须用 **“二阶段法”**。

### 二阶段法基本步骤

**Phase I：先找一个可行解**

1. 对所有约束：

   * $\le$ 约束：加 **松弛变量**；
   * $\ge$ 约束：减 **剩余变量**，再加 **人工变量**；
   * $=$ 约束：直接加 **人工变量**。

2. 以所有 **人工变量** 为基变量，构造一个 **辅助目标函数**：
   $$
   \min w = \text{所有人工变量之和}
   $$

3. 用单纯形法求解这个辅助问题：

   * 若最优值 $w^*>0$：说明人工变量不可能全部变成 0 ⇒ 原问题无可行解；
   * 若 $w^*=0$：说明找到了一个 **不含人工变量的基本可行解** ⇒ 可作为原问题 Phase II 的起点。

**Phase II：在找到的可行解上，优化原来的目标**

1. 去掉所有人工变量及 **Phase I** 的目标行；
2. 把 **原来的目标函数** 放入表中（注意，需要 **重新计算目标行检验数**）；
3. 从 **Phase I** 得到的基变量出发，用普通单纯形法迭代，最终得到原问题的最优解。



### 例题

> 用二阶段法求解如下问题的最优解
> $$
> \begin{aligned}
> \min\quad & z = 3x_1 - 2x_2 + x_3 \\
> \text{s.t.}\quad
> & 2x_1 + x_2 - x_3 \le 5, \\
> & 4x_1 + 3x_2 + x_3 \ge 3, \\
> & -x_1 + x_2 + x_3 = 2, \\
> & x_1,x_2,x_3 \ge 0.
> \end{aligned}
> $$

解答：

- 化为标准形 + 引入松弛 / 剩余 / 人工变量

  1. 第 1 条为 “≤” 约束，加 **松弛变量** $s_1\ge 0$：
     $$
     2x_1 + x_2 - x_3 + s_1 = 5
     $$

  - 第 2 条为 “≥” 约束，减 **剩余变量** $s_2\ge0$，再加 **人工变量** $a_2\ge0$：
    $$
    4x_1 + 3x_2 + x_3 - s_2 + a_2 = 3
    $$

  - 第 3 条为“=”约束，直接加 **人工变量** $a_3\ge0$：
    $$
    -x_1 + x_2 + x_3 + a_3 = 2
    $$

  所有变量非负：
  $$
  x_1,x_2,x_3,s_1,s_2,a_2,a_3 \ge 0
  $$
  **初始基变量**就是：
  $$
  s_1,\ a_2,\ a_3.
  $$

- **Phase I**：构造辅助问题，消除人工变量
  构造辅助目标函数：
  $$
  \min w = a_2 + a_3.
  $$
  对于当前辅助目标函数，并计算 $Z_j - C_j$ 得到目标行检验数，得到单纯形表格如下：

  | 基变量     | $x_1$（0） | $x_2$（0） | $x_3$（0） | $s_1$（0） | $s_2$（0） | $a_2$（1） | $a_3$（1） | RHS  |
  | ---------- | ---------- | ---------- | ---------- | ---------- | ---------- | ---------- | ---------- | ---- |
  | $s_1$（0） | 2          | 1          | -1         | 1          | 0          | 0          | 0          | 5    |
  | $a_2$（1） | 4          | 3          | 1          | 0          | -1         | 1          | 0          | 3    |
  | $a_3$（1） | -1         | 1          | 1          | 0          | 0          | 0          | 1          | 2    |
  | $w$        | 3          | 4          | 2          | 0          | -1         | 0          | 0          | 5    |

  - **第 1 次换基**（$x_2$ 进基、$a_2$ 离基）

    - **选定进基变量**（看目标行最正的系数对应的变量）：
      目标行中最正的系数为 $4$，对应变量 $x_2$。因此，$x_2$ 作为 **进基变量**。

    - **选定离基变量**（只看 $x_2$ 对应列的正数系数，找到 $\frac{右端常数}{系数}$ 最小比值）：

      发现 $a_2$ 对应的比值 $\frac{3}{3} = 1$ 最小。因此，$a_2$ 作为 **离基变量**。

    将 $x_2$ 换到 $a_2$ 的基变量位置， 之后行变换，将 **进基变量** $x_2$ 这一列变为 **单位列**：

    | 基变量     | $x_1$（0）     | $x_2$（0） | $x_3$（0）     | $s_1$（0） | $s_2$（0）     | $a_2$（1）     | $a_3$（1） | RHS  |
    | ---------- | -------------- | ---------- | -------------- | ---------- | -------------- | -------------- | ---------- | ---- |
    | $s_1$（0） | $\frac{2}{3}$  | 0          | $-\frac{4}{3}$ | 1          | $\frac{1}{3}$  | $-\frac{1}{3}$ | 0          | 4    |
    | $x_2$（0） | $\frac{4}{3}$  | 1          | $\frac{1}{3}$  | 0          | $-\frac{1}{3}$ | $\frac{1}{3}$  | 0          | 1    |
    | $a_3$（1） | $-\frac{7}{3}$ | 0          | $\frac{2}{3}$  | 0          | $\frac{1}{3}$  | $-\frac{1}{3}$ | 1          | 1    |
    | $w$        | $-\frac{7}{3}$ | 0          | $\frac{2}{3}$  | 0          | $\frac{1}{3}$  | $-\frac{4}{3}$ | 0          | 1    |

  - **第 2 次换基**（$x_3$ 进基、$a_3$ 离基）

    - **选定进基变量**（看目标行最正的系数对应的变量）：
      目标行中最正的系数为 $\frac{2}{3}$，对应变量 $x_3$。因此，$x_3$ 作为 **进基变量**。

    - **选定离基变量**（只看 $x_3$ 对应列的正数系数，找到 $\frac{右端常数}{系数}$ 最小比值）：

      发现 $a_3$ 对应的比值 $\frac{1}{\frac{2}{3}} = \frac{3}{2}$ 最小。因此，$a_3$ 作为 **离基变量**。

    将 $x_3$ 换到 $a_3$ 的基变量位置， 之后行变换，将 **进基变量** $x_3$ 这一列变为 **单位列**：

    | 基变量     | $x_1$（0）     | $x_2$（0） | $x_3$（0） | $s_1$（0） | $s_2$（0）     | $a_2$（1）     | $a_3$（1）     | RHS           |
    | ---------- | -------------- | ---------- | ---------- | ---------- | -------------- | -------------- | -------------- | ------------- |
    | $s_1$（0） | $-4$           | $0$        | $0$        | $1$        | $1$            | $-1$           | $2$            | $6$           |
    | $x_2$（0） | $\frac{5}{2}$  | $1$        | $0$        | $0$        | $-\frac{1}{2}$ | $\frac{1}{2}$  | $-\frac{1}{2}$ | $\frac{1}{2}$ |
    | $x_3$（0） | $-\frac{7}{2}$ | $0$        | $1$        | $0$        | $\frac{1}{2}$  | $-\frac{1}{2}$ | $\frac{3}{2}$  | $\frac{3}{2}$ |
    | $w$        | $0$            | $0$        | $0$        | $0$        | $0$            | $-1$           | $-1$           | $1$           |

  目标行检验数全部 $\le 0$，Phase I 达到最优解，且 **人工变量 $a_2, a_3$ 都是非基变量**。
  
  之后进入第二阶段 Phase II，基变量变为 $s_1, x_2, x_3$。
  
- **Phase II**：回到原目标函数
  $$
  \min z = 3x_1 - 2x_2 + x_3
  $$
  更新变量系数、去除人工变量并重新计算目标行检验数，得到单纯形表格如下：

  | 基变量      | $x_1$（3）      | $x_2$（-2） | $x_3$（1） | $s_1$（0） | $s_2$（0）     | RHS           |
  | ----------- | --------------- | ----------- | ---------- | ---------- | -------------- | ------------- |
  | $s_1$（0）  | $-4$            | $0$         | $0$        | $1$        | $1$            | $6$           |
  | $x_2$（-2） | $\frac{5}{2}$   | $1$         | $0$        | $0$        | $-\frac{1}{2}$ | $\frac{1}{2}$ |
  | $x_3$（1）  | $-\frac{7}{2}$  | $0$         | $1$        | $0$        | $\frac{1}{2}$  | $\frac{3}{2}$ |
  | $z$         | $-\frac{23}{2}$ | $0$         | $0$        | $0$        | $\frac{3}{2}$  | $\frac{1}{2}$ |

  - **第 1 次换基**（$s_2$ 进基、$x_3$ 离基）

    - **选定进基变量**（看目标行最正的系数对应的变量）：
      目标行中最正的系数为 $\frac{3}{2}$，对应变量 $x_3$。因此，$s_2$ 作为 **进基变量**。

    - **选定离基变量**（只看 $s_2$ 对应列的正数系数，找到 $\frac{右端常数}{系数}$ 最小比值）：

      发现 $s_2$ 对应的比值 $\frac{\frac{3}{2}}{\frac{1}{2}} = 3$ 最小。因此，$x_3$ 作为 **离基变量**。

    将 $s_2$ 换到 $x_3$ 的基变量位置， 之后行变换，将 **进基变量** $s_2$ 这一列变为 **单位列**：

    | 基变量      | $x_1$（3） | $x_2$（-2） | $x_3$（1） | $s_1$（0） | $s_2$（0） | RHS  |
    | ----------- | ---------- | ----------- | ---------- | ---------- | ---------- | ---- |
    | $s_1$（0）  | $3$        | $0$         | $-2$       | $1$        | $0$        | $3$  |
    | $x_2$（-2） | $-1$       | $1$         | $1$        | $0$        | $0$        | $2$  |
    | $s_2$（0）  | $-7$       | $0$         | $2$        | $0$        | $1$        | $3$  |
    | $z$         | $-1$       | $0$         | $-3$       | $0$        | $0$        | $-4$ |
  
  
  目标行检验数全部 $\le 0$，Phase II 达到最优解。
  得到最优解即右边的系数，$x_2$ 为 2，其余变量为 $0$，最优值即 $-4$。

**最优解**：
$$
x_1^* = 0, \quad x_2^* = 2, \quad x_3^* = 0
$$
**目标函数最优值**：
$$
z_{\min} = -4
$$

---

