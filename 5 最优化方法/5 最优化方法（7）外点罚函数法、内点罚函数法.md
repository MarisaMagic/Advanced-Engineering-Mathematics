<h1>
    <div align='center'>
        第五章 最优化方法（7）
        外点罚函数法、内点罚函数法 
    </div>
</h1>

## 外点罚函数法

### 算法思想

原问题是带不等式约束的极小化：
$$
\min f(x),\quad g_i(x)\ge 0,\ i=1,\dots,m.
$$

外点法把“**违反约束**”这件事当成一种“罚款”：点越不满足约束，罚得越重。于是构造一个**无约束的罚函数**：
$$
F(x,\mu)=f(x)+\mu\sum_{i=1}^m \varphi(g_i(x)),
$$
其中 $\varphi(\cdot)\ge0$ 且当 $g_i(x)\ge 0$ 时为 0，常见选法是
$$
\varphi(g_i(x)) = \max \{0,-g_i(x)\}^2 \quad\text{或}\quad \max \{0,-g_i(x)\}.
$$

### 算法过程

1. 取一列逐渐 **增大** 的罚参数 $\mu_k\to+\infty$；
2. 对每个 $\mu_k$，求**无约束极小点**：
   $$
   x^{(k)}=\arg\min_x F(x,\mu_k) ;
   $$
3. 在合适条件下，$x^{(k)}$ 会渐渐逼近原约束问题的最优解。



### 例题

> 用外点罚函数法求解下列问题：
> $$
> \min f(x)=(x_1-3)^2+(x_2-2)^2,\quad
> \text{s.t. } g(x)= 4 - x_1 -x_2 \ge0.
> $$

解答：

- 构造罚函数

  把约束改写成“违反量” $x_1+x_2-4$，于是可取平方罚函数
  $$
  F(x,\mu) = f(x)+\mu[\max \{0,x_1+x_2-4\}]^2.
  $$

- 若不用罚函数，直接看约束：
  无约束时
  $$
  \min (x_1-3)^2+(x_2-2)^2
  $$
  的极小点是 $(3,2)$，但此时 $x_1+x_2=5>4$，但是 **不满足约束**。

- 用罚函数看逼近过程

  若 $x_1+x_2>4$，此时
  $$
    F(x,\mu)=(x_1-3)^2+(x_2-2)^2+\mu(x_1+x_2-4)^2.
  $$
  这是一个无约束二次函数，其极小点由
  $$
    \nabla F=0
  $$
  得
  $$
  \begin{cases}
    2(x_1-3)+2\mu(x_1+x_2-4)=0,\\
    2(x_2-2)+2\mu(x_1+x_2-4)=0.
   \end{cases}
  $$
  两式相减得 $x_1-3=x_2-2\Rightarrow x_1=x_2+1$。代回任一式可得
  $$
  x_1=\dfrac{5\mu+3}{2\mu+1},\quad
    x_2=\dfrac{3\mu+2}{2\mu+1}.
  $$
  

当 $\mu\to+\infty$ 时：
$$
x_1(\mu)\to\frac{5}{2},\quad x_2(\mu)\to\frac{3}{2},
$$
趋于约束问题的最优解 
$$
x^{*} = (\tfrac52,\tfrac32).
$$
验证：$x_1 + x_2 = \frac{5}{2} + \frac{3}{2} = 4$，恰好在约束边界上。 

---



## 内点罚函数法（障碍函数法）

### 算法思想

对于
$$
\min f(x),\quad g_i(x)\ge0,
$$
要求最终解在**可行域内部**，不允许走到外面，因此构造一种在约束边界附近会“炸掉”的函数作为**障碍**，典型是对数障碍：
$$
B(x,\mu)=f(x)-\mu\sum_{i=1}^m \ln g_i(x),\quad \mu>0.
$$
如果使用的是 倒数障碍：
$$
B(x,\mu)=f(x)+\mu\sum_{i=1}^m \frac{1}{g_i(x)},\quad \mu>0.
$$
注意：只有在 $g_i(x)>0$ 时才有意义，这就强迫 $x$ 始终待在可行域内部。

### 算法过程

1. 选一列逐渐 **减小** 的参数 $\mu_k\rightarrow 0$；
2. 对每个 $\mu_k$，在可行域内部求无约束极小点：
   $$
   x^{(k)}=\arg\min_{g_i(x)>0} B(x,\mu_k);
   $$
3. 在合适条件下，$x^{(k)}$ 会沿着所谓“中心路径”收敛到原问题的最优解。

因为始终在**可行域内部（内点）**游走，所以叫内点/障碍函数法。


### 例题

> 用对数障碍函数法求解下列问题：
> $$
> \min f(x)=\frac12(x_1+1)^2+x_2,
> \quad\text{s.t. }
> \begin{cases}
> x_1-1\ge0,\\
> x_2\ge0.
> \end{cases}
> $$

解答：

- 构造对数障碍函数

  把约束写成 $g_1(x)=x_1-1\ge0,\ g_2(x)=x_2\ge0$。

  对数障碍函数为
  $$
  F(x,\mu)=\frac12(x_1+1)^2+x_2-\mu\ln(x_1-1)-\mu\ln x_2,\quad \mu>0.
  $$

- 对固定 $\mu$ 求无约束极小点

  求梯度为 0：
  $$
  \begin{cases}
  \frac{\partial F}{\partial x_1}=(x_1+1)-\dfrac{\mu}{x_1-1}=0,\\
  \frac{\partial F}{\partial x_2}=1-\dfrac{\mu}{x_2}=0.
  \end{cases}
  $$

  第二个方程直接给出
  $$
  x_2=\mu
  $$

  第一个方程：
  $$
  (x_1+1)(x_1-1)-\mu=0
  \ \Rightarrow \
  x_1=\sqrt{1+\mu}
  $$
  取正根以满足 $x_1>1$.

  因此，对于任意 $\mu>0$，障碍子问题的极小点为
  $$
  x_1(\mu)= \sqrt{1+\mu}, \quad x_2(\mu) = \mu
  $$



当 $\mu\rightarrow 0$ 时：
$$
x_1(\mu)\to\sqrt{1}=1,\quad x_2(\mu)\to0,
$$
收敛到原问题的最优解
$$
x^*=(1,0).
$$
验证：$x_1 = 1 \ge 1, x_2 = 0 \ge 0$，正好在约束边界上。

---

如果改用 倒数障碍函数：
解答：

* **构造倒数障碍函数**

  对本题，取
  $$
  F(x,\mu)
  =\frac12(x_1+1)^2+x_2
  +\mu\Big(\frac{1}{x_1-1}+\frac{1}{x_2}\Big),\quad \mu>0,
  $$
  定义域为 $x_1>1,\ x_2>0$。

* **对固定 $\mu$ 求无约束极小点**

  求梯度为 0：
  $$
  \begin{cases}
  \dfrac{\partial \widetilde F}{\partial x_1}
  =(x_1+1)-\dfrac{\mu}{(x_1-1)^2}=0, \\
  \dfrac{\partial \widetilde F}{\partial x_2}
  =1-\dfrac{\mu}{x_2^{2}}=0.
  \end{cases}
  $$

  由第二个方程得到
  $$
  x_2^2=\mu \ \Rightarrow\ x_2=\sqrt{\mu}\quad(\text{取正根以保证 }x_2>0).
  $$

  第一个方程可写成
  $$
  (x_1+1)(x_1-1)^2=\mu.
  $$

  对任意给定的 $\mu>0$，这是一个关于 $x_1$ 的三次方程，解出满足 $x_1>1$ 的那一支即为极小点 $x_1(\mu)$。

* **考察 $\mu\to0^+$ 时的极限**

  当 $\mu\to0^+$ 时，右端 $\mu\to0$，而左端
  $(x_1+1)(x_1-1)^2\ge0$。要使等式成立，只能有
  $(x_1+1)(x_1-1)^2\to0$。在可行域内 $x_1>1$，因此极限点必满足
  $$
  x_1\to1^+.
  $$

  同时有
  $$
  x_2(\mu)=\sqrt{\mu}\to0^+.
  $$

  于是倒数障碍法得到的点列 $(x_1(\mu),x_2(\mu))$ 仍然收敛到
  $$
  x^*=(1,0),
  $$
  与对数障碍函数法和原始问题的最优解一致。
